<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PLANT DISEASE DETECTION</title>

  <style>
    :root{
      --accent:#2aa893;
      --accent-2:#1f8f74;
      --muted:#6f7b7a;
      --radius:14px;
      --maxwidth:1000px;
    }

    html,body{
      height:100%;
      margin:0;
      padding:0;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      color:#ffffff;
    }

    /* -----------------------------------------
       BACKGROUND USING YOUR PROVIDED IMAGE
       Light-medium overlay → background visible
       ----------------------------------------- */
    body{
      background:
        linear-gradient(rgba(0,0,0,0.18), rgba(0,0,0,0.30)),
        url("https://img.lovepik.com/photo/50771/6695.jpg_wh860.jpg")
        center/cover fixed no-repeat;
      background-blend-mode: darken;
      padding:28px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* NAVBAR */
    nav{
      max-width:var(--maxwidth);
      margin:0 auto 22px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }

    .brand{ display:flex; align-items:center; gap:12px; }

    .leaf{
      width:44px;
      height:44px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      box-shadow:0 6px 18px rgba(10,20,20,0.35);
    }
    .leaf svg{ width:22px; height:22px; fill:white; }

    .brand h1{
      margin:0;
      font-size:20px;
      font-weight:800;
      color:#f7fff8;
      letter-spacing:0.6px;
    }

    .navlinks{
      display:flex;
      gap:14px;
    }
    .navlinks a{
      color:rgba(255,255,255,0.9);
      text-decoration:none;
      font-weight:600;
    }
    .navlinks a:hover{ text-decoration:underline; }

    /* MAIN CONTENT */
    .container{ max-width:var(--maxwidth); margin:0 auto; }

    .card{
      background:rgba(255,255,255,0.10);
      padding:20px;
      border-radius:var(--radius);
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    header h2{ margin:0; font-size:26px; font-weight:800; }
    header p.lead{ margin:6px 0 0 0; color:#d5dcd9; font-size:14px; }

    /* DROPZONE */
    #dropzone{
      margin-top:16px;
      padding:18px;
      border-radius:12px;
      border:2px dashed rgba(255,255,255,0.25);
      text-align:center;
      cursor:pointer;
      transition:all .15s ease;
    }
    #dropzone.dragover{
      border-color:#fff;
      background:rgba(255,255,255,0.08);
    }
    #dropzone strong{
      display:block;
      margin-bottom:6px;
      font-size:16px;
      font-weight:700;
    }

    input[type="file"]{ display:none; }

    /* BUTTONS */
    .controls{
      margin-top:14px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .btn{
      padding:10px 16px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:800;
    }
    .btn-primary{
      background:var(--accent);
      color:#062d24;
    }
    .btn-secondary{
      background:#fff;
      color:#09332e;
    }
    .btn-ghost{
      background:rgba(255,255,255,0.12);
      color:white;
    }

    /* CONTENT GRID */
    .layout{
      margin-top:18px;
      display:grid;
      grid-template-columns:320px 1fr;
      gap:20px;
    }
    @media(max-width:900px){
      .layout{ grid-template-columns:1fr; }
    }

    /* PREVIEW */
    .preview{
      height:320px;
      background:rgba(0,0,0,0.25);
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .preview img{
      max-width:100%;
      max-height:100%;
      object-fit:cover;
    }
    .empty{ color:#d3d8d6; }

    /* RESULTS */
    .results{
      background:rgba(0,0,0,0.28);
      padding:14px;
      border-radius:12px;
    }
    .status{
      color:#d3d9d7;
      margin-bottom:12px;
      font-weight:700;
    }

    .pred-list{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .pred{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px;
      border-radius:10px;
      background:rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.1);
    }

    .pred h4{
      margin:0;
      font-size:15px;
      font-weight:800;
    }
    .pred small{ color:#bcc6c3; }

    .bar{
      flex:1;
      height:12px;
      border-radius:999px;
      background:rgba(255,255,255,0.12);
      overflow:hidden;
    }
    /* ensure filler is a block, starts at 0 and transitions */
.bar > i{
  display:block;              /* ensure width animates properly */
  width:0%;
  height:100%;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  transition: width 0.8s ease; /* keep the smooth animation */
  border-radius:999px;
}
    .pct{
      min-width:52px;
      text-align:right;
      color:#cbd4d2;
      font-weight:700;
    }

    /* SPINNER */
    .spinner-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    .spinner{
      background:rgba(255,255,255,0.10);
      padding:18px 22px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:12px; height:12px;
      border-radius:50%;
      background:var(--accent);
      animation:pulse 1s infinite;
    }
    .dot:nth-child(2){ animation-delay:.12s; background:var(--accent-2); }
    .dot:nth-child(3){ animation-delay:.24s; background:#91f0d8; }

    @keyframes pulse{
      0%{ transform:scale(.6); opacity:.6 }
      50%{ transform:scale(1); opacity:1 }
      100%{ transform:scale(.6); opacity:.6 }
    }

  </style>
</head>

<body>

  <nav>
    <div class="brand">
      <div class="leaf" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M12 2c.5 0 1 .1 1.6.3 2 .7 4.2 2.8 5 5 .3.9.4 1.9.4 2.8 0 2.5-1.5 5-4 7.6S9.4 22 6 22v-4c.4-1.2 2-4.6 2-8C8 8.5 7.6 7 7 5.5 6.5 4.2 9 2 12 2z"/>
        </svg>
      </div>
      <h1>PLANT DISEASE DETECTION</h1>
    </div>

    <div class="navlinks">
      <a href="#">Home</a>
      <a href="#">About</a>
      <a href="#">Docs</a>
    </div>
  </nav>

  <main class="container">
    <section class="card">

      <header>
        <h2>Upload a leaf image</h2>
        <p class="lead">The model predicts the top 3 likely plant diseases.</p>
      </header>

      <div id="dropzone">
        <strong>Drop image here or click to select</strong>
        <span style="font-size:13px;color:#d7dfdd;">JPG / PNG recommended</span>
      </div>

      <div class="controls">
        <label class="btn btn-primary">
          Choose file
          <input type="file" id="fileInput" accept="image/*" />
        </label>

        <button class="btn btn-secondary" id="predictBtn">Predict</button>
        <button class="btn btn-ghost" id="clearBtn">Clear</button>
      </div>

      <div class="layout">
        <!-- PREVIEW -->
        <div>
          <div class="preview" id="preview">
            <div class="empty">No image selected</div>
          </div>
        </div>

        <!-- RESULTS -->
        <div class="results">
          <div class="status" id="status">Ready</div>
          <div class="pred-list" id="predList"></div>
        </div>
      </div>

    </section>
  </main>

  <!-- SPINNER -->
  <div class="spinner-overlay" id="spinner">
    <div class="spinner">
      <strong>Predicting…</strong>
      <div style="display:flex;gap:8px;">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <small style="color:#d3dcd9;">This may take a moment</small>
    </div>
  </div>

<script>
  const API_URL = "http://127.0.0.1:8000/predict";

  const fileInput = document.getElementById("fileInput");
  const predictBtn = document.getElementById("predictBtn");
  const clearBtn = document.getElementById("clearBtn");
  const dropzone = document.getElementById("dropzone");
  const preview = document.getElementById("preview");
  const statusEl = document.getElementById("status");
  const predList = document.getElementById("predList");
  const spinner = document.getElementById("spinner");

  let currentFile = null;

  function showSpinner(show){
    spinner.style.display = show ? "flex" : "none";
  }

  function resetUI(){
    preview.innerHTML = '<div class="empty">No image selected</div>';
    predList.innerHTML = "";
    statusEl.textContent = "Ready";
    currentFile = null;
    fileInput.value = "";
  }

  function displayImage(file){
    const reader = new FileReader();
    reader.onload = e => {
      preview.innerHTML = `<img src="${e.target.result}" alt="Leaf">`;
    };
    reader.readAsDataURL(file);
  }

  dropzone.addEventListener("click", ()=> fileInput.click());
  dropzone.addEventListener("dragover", e=>{
    e.preventDefault();
    dropzone.classList.add("dragover");
  });
  dropzone.addEventListener("dragleave", ()=> dropzone.classList.remove("dragover"));
  dropzone.addEventListener("drop", e=>{
    e.preventDefault();
    dropzone.classList.remove("dragover");
    const f = e.dataTransfer.files[0];
    if(!f) return;
    currentFile = f;
    displayImage(f);
    fileInput.files = e.dataTransfer.files;
    statusEl.textContent = "Image selected — ready to predict";
  });

  fileInput.addEventListener("change", ()=>{
    const f = fileInput.files[0];
    if(!f) return;
    currentFile = f;
    displayImage(f);
    statusEl.textContent = "Image selected — ready to predict";
  });

  clearBtn.addEventListener("click", resetUI);

  predictBtn.addEventListener("click", async ()=>{
    if(!currentFile){
      statusEl.textContent = "Please upload an image first.";
      return;
    }

    showSpinner(true);
    statusEl.textContent = "Predicting...";

    const fd = new FormData();
    fd.append("file", currentFile);

    try {
      const res = await fetch(API_URL, { method:"POST", body:fd });
      if(!res.ok) throw new Error("Server error");

      const data = await res.json();

      predList.innerHTML = "";
      statusEl.textContent = "Prediction complete";

      data.predictions.slice(0,3).forEach(p=>{
  const row = document.createElement("div");
  row.className = "pred";
  row.innerHTML = `
    <div class="meta" style="width:38%">
      <h4 style="margin:0">${p.label}</h4>
      <small style="color:#c1ccc9">Index: ${p.index}</small>
    </div>
    <div class="bar" style="margin:0 12px;"><i></i></div>
    <div class="pct" style="min-width:52px;text-align:right">${(p.confidence*100).toFixed(1)}%</div>
  `;
  predList.appendChild(row);

  const filler = row.querySelector(".bar > i");
  filler.style.width = "0%";      // start collapsed (important)

  void filler.offsetWidth;        // force reflow

  requestAnimationFrame(() => {
    filler.style.width = (p.confidence * 100) + "%";   // animate fill
  });
});

    } catch(e){
      statusEl.textContent = "Network or server error";
    }

    showSpinner(false);
  });

  resetUI();
</script>

</body>
</html>